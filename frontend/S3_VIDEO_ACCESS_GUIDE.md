# S3の動画ファイルへのAccessDeniedエラー解決ガイド

S3にアップロードしたファイル（例: MP4動画）に直接URLでアクセスした際に `AccessDenied` となる場合、以下の設定を確認・変更することで解決できる可能性が高いです。

## ステップ1: S3バケットの「パブリックアクセスをブロック」設定の確認

まず、バケット自体がパブリックアクセスを許可しているか確認します。

1.  **AWSマネジメントコンソール**にログインし、S3のサービスページに移動します。
2.  対象のS3バケットを選択します。
3.  **[アクセス許可]** タブをクリックします。
4.  **[パブリックアクセスをブロック (バケット設定)]** のセクションで、[編集] をクリックします。
5.  **「パブリックアクセスをすべてブロック」** のチェックを**外します**。
6.  変更を保存します。警告が表示されますが、内容を理解した上で確認・保存してください。

**注意:** この設定を変更すると、バケット内のオブジェクトが（設定次第で）インターネット全体に公開される可能性があります。セキュリティリスクを十分に理解した上で進めてください。

## ステップ2: バケットポリシーの設定

次に、バケット内のオブジェクトへの読み取りアクセスを許可するポリシーを設定します。

1.  同じくS3バケットの **[アクセス許可]** タブを開きます。
2.  **[バケットポリシー]** のセクションで、[編集] をクリックします。
3.  以下のJSONポリシーを貼り付けます。

    **【重要】** 下記の `YOUR_BUCKET_NAME` の部分を、ご自身の実際のバケット名に必ず置き換えてください。（例: `my-video-storage` など）

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::YOUR_BUCKET_NAME/*"
        }
    ]
}
```

このポリシーは、バケット内のすべてのオブジェクト (`/*`) に対して、誰でも (`"Principal": "*"`) 読み取り (`s3:GetObject`) を許可する設定です。

**エラーが出る場合のチェックポイント:**
-   `YOUR_BUCKET_NAME` を実際のバケット名に置き換えましたか？
-   バケット名の前後の `:::` や `/*` を誤って削除していませんか？
-   コピー＆ペーストの際に、余分な文字や改行が入っていませんか？

4.  変更を保存します。

## ステップ3: CORS (クロスオリジンリソース共有) 設定

ウェブページから動画を再生する場合、CORS設定が必要になることがあります。

1.  S3バケットの **[アクセス許可]** タブを開きます。
2.  **[クロスオリジンリソース共有 (CORS)]** のセクションで、[編集] をクリックします。
3.  以下のJSON設定を貼り付けます。

```json
[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "GET",
            "HEAD"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": []
    }
]
```

**AllowedOrigins** の `"*"` はすべてのドメインからのアクセスを許可します。セキュリティを強化したい場合は、`"http://localhost:3000"` や実際のウェブサイトのドメイン (`"https://your-website.com"`) に限定することをお勧めします。

4.  変更を保存します。

## まとめ

上記の設定を行うことで、S3のURLに直接アクセスして動画を再生できるようになるはずです。

- **より安全な方法:** もし動画を不特定多数に公開したくない場合は、**署名付きURL (Pre-signed URL)** を使用する方法を検討してください。これは、アプリケーション側で一時的に有効なURLを生成する方式で、よりセキュアです。
